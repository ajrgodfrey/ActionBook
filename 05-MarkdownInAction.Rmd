# Use of R markdown to generate an analysis efficiently {#RMarkdown} 

In a general sense, R markdown has been used to create reports and package vignettes because it creates an analysis that is reproducible. The `BrailleR` package started to use R markdown in late 2014 as a method for generating simple analyses that might be needed by students taking introductory statistics courses. Since that time, the prevalence of R markdown as a teaching tool in these courses has increased. The functions described below are therefore also generating example R markdown files to help learn how to use R markdown.

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(fig.width=7, fig.height=5, comment="")
library(BrailleR)
```

You will need the `BrailleR` package to be ready for use to follow along with the examples in this chapter. Do this by issuing the command `library(BrailleR)` now.


## General information

Each command described in this chapter and other similar commands draft a new R markdown file and then compile it to an HTML file that is easily read by a screen reader user.

This HTML file is opened automatically if R is being used interactively, giving the blind user immediate access to the information. The content is presented using sufficiently marked up HTML code including headings and tables so that the blind user can make best use of their  screen reading software. All graphs, which are given an "alt tag" when they are included in the HTML file, can be presented using a text description available from the `VI()` functionality of the `BrailleR` package.

In addition, the blind user may need any/all of the graphs in a variety of formats (png, pdf, eps, or svg), nicely formatted tables for insertion into documents (LaTeX or HTML), and access to the code that generated these graphs and tables (an R script). 

While these commands show the use of R markdown in action, they cannot actually be used within a user's R markdown document. If you wish to get the output you observe within the HTML documents that will be generated, you will need to extract the relevant parts of the R markdown script files that the commands create. 




## Description of a single numeric variable

There are many commands needed to get the numeric and graphic summary measures that might be required to collect all relevant information on a single numeric variable. The `UniDesc()` command has been written as a shortcut for a blind user who wishes to obtain:

- the counts of points in the sample that were observed and not observed,
- the mean and trimmed mean,
- the five number summary: minimum, lower quartile, median, upper quartile, and maximum,
- the interquartile range (IQR) and standard deviation,
- measures of skewness and kurtosis (thanks to the `moments` package),
- a histogram and/or a boxplot,
- a normality (quantile-quantile) plot,
- various tests for normality (thanks to the `nortest` package), and
- tests on the significance of the skewness and kurtosis (again, thanks to the `moments` package).

The `UniDesc()` function can deliver all of this with minimal effort from the user.

An example of the main output document (HTML) can be viewed by re-issuing the commands generated by calling  
```{r ExampleUniDesc, eval=FALSE}
example(UniDesc)
```
while running R interactively. This issues the following commands.

```{r exampleUniDescRL, echo=FALSE}
cat(paste(GetExampleText(UniDesc), collapse="\n"), file="RunLater.R", append=TRUE)
```

```{r getUniDescExampleText, echo=FALSE}
cat(paste(GetExampleText(UniDesc), collapse="\n"))
```

There is one small change to make To get the desired outcome. The argument `View=FALSE` stops the default action which is to open the HTML document automatically. This avoids problems while the BrailleR package is being created. The `UniDesc()` function was designed for interactive use so do not include this argument if you do want this function to open the HTML file automatically.

As an alternative, and if you do have a current internet connection you can view the result of running the [`UniDesc()` command on the Ozone data](https://R-Resources.massey.ac.nz/BrailleRInAction/Ozone-UniDesc.html) in your browser without having to re-enter the example commands.



## Analysis of a single continuous variable with respect to a single grouping factor

There are many commands needed to get the numeric and graphic summary measures that might be required to collect all relevant information on a single numeric variable when it might depend on a  grouping factor. The `OneFactor()` command has been written as a shortcut for a blind user who wishes to obtain:

- the counts of observations within each group,
- the mean, standard deviation and standard error for each group,
- comparative boxplots and/or dotplots, 
- the one-way analysis of variance, and
- Tukey's Honestly Significant Difference (HSD) test on the significance of the between group differences.




An example of the main output document (HTML) can be viewed by re-issuing the commands generated by calling  
```{r ExampleOneFactor, eval=FALSE}
example(OneFactor)
```
while running R interactively. This issues the following commands.

```{r exampleOneFactorRL, echo=FALSE}
cat(paste(GetExampleText(OneFactor), collapse="\n"), file="RunLater.R", append=TRUE)
```

```{r getOneFactorExampleText, echo=FALSE}
cat(paste(GetExampleText(OneFactor), collapse="\n"))
```

As before, there is one small change to make To get the desired outcome. The argument `View=FALSE` which stops the HTML document opening automatically needs to be removed.

As an alternative, and if you do have a current internet connection you can view the result of running the [`OneFactor()` command on the Ozone data](https://R-Resources.massey.ac.nz/BrailleRInAction/Ozone.Month-OneFactor.html) in your browser without having to re-enter the example commands.

The example here demonstrates the point that the grouping variable must be a factor. The month variable is not stored as a factor in the airquality data so its use would have created an error.

## Use of BrailleR for linear regression 

It is common for sighted users to create a handful of graphs that help them determine the validity of a linear model, even the most basic simple linear regressions. The `VI()` command can be applied to a linear model object. The specific function to do this is found in the VI.lm()` function, but most users do not need to explicitly use `VI.lm()` because the call to `VI()` will know to use the `VI.lm()` function if it is the right one to use at the time.

The `VI.lm()` function generates so much text as a substitute for the graphs used by sighted users, that it is easier to put this text in an HTML document and have that new document opened in a browser instead of trying to use a screen reader within the R session.

Let's see an example using the `airquality` data. A simple linear regression model might be created and investigated using:
```{r AirQuality.lm, fig.height=9, fig.width=9, fig.cap="Diagnostic plots for the simple linear regression model."}
data(airquality)
MyModel = lm(Ozone~Temp, data=airquality)
summary(MyModel)
par(mfrow=c(2,2))
plot(MyModel)
```


```{r addVI.lmExample}
cat(paste("MyModel = lm(Ozone~Temp, data=airquality, echo=FALSE)",
    "VI(MyModel)", 
    sep="\n"), file="RunLater.R", append=TRUE)
```


The user now has a model stored as `MyModel` in the current workspace, has printed a summary of that model, and has plotted a set of four diagnostic plots in a $2\times{}2$ grid. The blind user will still need to issue those commands so that the output is created to meet the expectations of the sighted audience, but will also find value in issuing the two extra commands
```{r AirQuality.lmVIEcho, eval=FALSE}
VI(MyModel)
VI(summary(MyModel))
```
The use of the second of these commands will generate
```{r AirQuality.lmVIEval, echo=FALSE}
VI(summary(MyModel))
```
which will be a much easier reading exercise for a screen reader user than would be the standard `summary()` output given earlier. Note that not all the information contained in the standard summary is contained in this output.

The output from use of the `VI()` command on the linear model can be viewed in your browser if you have a current internet connection. If you do not have a connection at this time, you will need to re-issue some of the above commands for yourself in an R session.

## Analysis of a single continuous variable with respect to another continuous variable

The `OnePredictor()` command is similar to the `OneFactor()` command describe earlier in this chapter and makes use of the `VI()` command as applied to the simple linear regression model fitted to a pair of continuous variables, one of which is determined to respond to the other.
The `OnePredictor()` command has been written as a shortcut for a blind user who wishes to obtain:

- the counts of observations within each group,



An example of the main output document (HTML) can be viewed by re-issuing the commands generated by calling  
```{r ExampleOnePredictor, eval=FALSE}
example(OnePredictor)
```
while running R interactively. This issues the following commands.

```{r exampleOnePredictorRL, echo=FALSE}
cat(paste(GetExampleText(OnePredictor), collapse="\n"), file="RunLater.R", append=TRUE)
```

```{r getOnePredictorExampleText, echo=FALSE}
cat(paste(GetExampleText(OnePredictor), collapse="\n"))
```

As before, there is one small change to make To get the desired outcome. The argument `View=FALSE` which stops the HTML document opening automatically needs to be removed.

As an alternative, and if you do have a current internet connection you can view the result of running the [`OnePredictor()` command on the Ozone data](https://R-Resources.massey.ac.nz/BrailleRInAction/Ozone-OnePredictor.html) in your browser without having to re-enter the example commands.

## BrailleR commands used in this chapter


The first two `BrailleR` commands introduced in this chapter were the `UniDesc()` and `OneFactor()` commands; they used the `VI()` command in the R markdown files that they create, as was described back in Chapter \@ref(VI), to give the text descriptions for graphs. We then saw a new use of the `VI()` command and several other commands designed to generate common analyses quickly. These included the `OnePredictor()`, etc.  
